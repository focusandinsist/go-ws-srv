# go-ws-srv
 
q:æœ‰socketIOä¸ºå•¥è¿˜åšè¿™ä¸ªï¼Ÿ
a:é‚£åƒåœ¾socketIoé¢‘ç¹æ›´æ–°è¿˜ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œè°ç”¨è°sb

è¿™é‡Œæ˜¯ WebSocket æ¨é€ç³»ç»Ÿ çš„ æ–‡ä»¶æ¶æ„è®¾è®¡ï¼ŒæŒ‰ç…§ æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†ï¼Œä¿è¯ é«˜å¹¶å‘ã€å¯æ‰©å±•ã€åˆ†å¸ƒå¼æ”¯æŒï¼Œç›®æ ‡æ˜¯ Socket.IO æ›¿ä»£å“ã€‚

ğŸ“‚ æ–‡ä»¶ç»“æ„
go-ws-srv/
â”‚â”€â”€ cmd/                  # å…¥å£ç›®å½•
â”‚   â”œâ”€â”€ main.go           # å¯åŠ¨ WebSocket æœåŠ¡å™¨
â”‚
â”‚â”€â”€ config/               # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.yaml       # é…ç½®æ–‡ä»¶ (ç«¯å£ã€Redis åœ°å€ç­‰)
â”‚   â”œâ”€â”€ config.go         # è§£æé…ç½®æ–‡ä»¶
â”‚
â”‚â”€â”€ internal/             # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ server/           # WebSocket æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ server.go     # WebSocket æœåŠ¡å™¨å…¥å£
â”‚   â”œâ”€â”€ connection/           # WebSocket æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ manager.go # è¿æ¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ connection.go # è¿æ¥ï¼ˆå­˜å‚¨åœ¨çº¿ç”¨æˆ·ã€å¿ƒè·³æ£€æµ‹ï¼‰
â”‚   â”œâ”€â”€ handler/           # WebSocket æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ handler.go    # å¤„ç† WebSocket äº‹ä»¶
â”‚   â”œâ”€â”€ message/           # WebSocket æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ manager.go # æ¶ˆæ¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ message.go    # æ¶ˆæ¯ï¼ˆå¹¿æ’­ã€ç§èŠã€é¢‘é“ï¼‰
â”‚   â”œâ”€â”€ room/           # WebSocket æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ room.go       # é¢‘é“/æˆ¿é—´ç®¡ç†
â”‚   â”œâ”€â”€ auth/           # WebSocket æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ auth.go       # è®¤è¯ï¼ˆJWT / Token éªŒè¯ï¼‰
â”‚   â”œâ”€â”€ storage/          # å­˜å‚¨å±‚
â”‚   â”‚   â”œâ”€â”€ redis.go      # Redis å­˜å‚¨ç”¨æˆ·çŠ¶æ€ / æ¶ˆæ¯é˜Ÿåˆ—
â”‚   â”‚   â”œâ”€â”€ db.go         # MongoDB / MySQL å­˜å‚¨å†å²æ¶ˆæ¯
â”‚   â”œâ”€â”€ broker/           # æ¶ˆæ¯åˆ†å‘å±‚
â”‚   â”‚   â”œâ”€â”€ redis_broker.go # ä½¿ç”¨ Redis Pub/Sub è¿›è¡Œæ¶ˆæ¯åŒæ­¥
â”‚   â”‚   â”œâ”€â”€ kafka_broker.go # ä½¿ç”¨ Kafka è¿›è¡Œæ¶ˆæ¯åŒæ­¥
â”‚
â”‚â”€â”€ api/                  # æä¾› HTTP API
â”‚   â”œâ”€â”€ rest/             # REST API
â”‚   â”‚   â”œâ”€â”€ user.go       # è·å–åœ¨çº¿ç”¨æˆ·
â”‚   â”‚   â”œâ”€â”€ message.go    # å‘é€æ¶ˆæ¯æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ websocket/        # WebSocket API
â”‚   â”‚   â”œâ”€â”€ ws_handler.go # WebSocket å¤„ç†å…¥å£
â”‚
â”‚â”€â”€ pkg/                  # é€šç”¨å·¥å…·åŒ…
â”‚   â”œâ”€â”€ logger/           # æ—¥å¿—ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ logger.go     # æ—¥å¿—å°è£…
â”‚   â”œâ”€â”€ utils/            # å¸¸ç”¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ json.go       # JSON å¤„ç†
â”‚   â”‚   â”œâ”€â”€ uuid.go       # ç”Ÿæˆå”¯ä¸€ ID
â”‚
â”‚â”€â”€ test/                 # æµ‹è¯•
â”‚   â”œâ”€â”€ load_test.go      # å‹æµ‹è„šæœ¬ï¼ˆæ¨¡æ‹Ÿ 10w+ è¿æ¥ï¼‰
â”‚
â”‚â”€â”€ go.mod                # Go ä¾èµ–ç®¡ç†
â”‚â”€â”€ Dockerfile            # Docker éƒ¨ç½²
â”‚â”€â”€ README.md             # é¡¹ç›®æ–‡æ¡£


ğŸ“Œ current features:
WebSocket æœåŠ¡å™¨ (internal/server/)
    server.goï¼šç›‘å¬ WebSocket è¿æ¥ï¼Œç®¡ç† goroutine
    connection.goï¼šå­˜å‚¨åœ¨çº¿ç”¨æˆ·ã€å¿ƒè·³æ£€æµ‹ã€æ–­çº¿æ¢å¤
    message.goï¼šå¤„ç†å¹¿æ’­ã€ç§èŠã€æˆ¿é—´å†…èŠå¤©
    auth.goï¼šæ”¯æŒ JWT è®¤è¯ï¼Œä¿è¯è¿æ¥å®‰å…¨
    room.goï¼šæ”¯æŒé¢‘é“ç®¡ç†ï¼Œç”¨æˆ·å¯ä»¥è®¢é˜…é¢‘é“

æ¶ˆæ¯åˆ†å‘ (internal/broker/)
    redis_broker.goï¼šç”¨ Redis Pub/Sub è¿›è¡Œè·¨æœåŠ¡å™¨æ¶ˆæ¯åŒæ­¥
    kafka_broker.goï¼šç”¨ Kafka è¿›è¡Œå¤§è§„æ¨¡æ¶ˆæ¯åˆ†å‘

å­˜å‚¨ (internal/storage/)
    redis.goï¼šç”¨ Redis å­˜å‚¨åœ¨çº¿ç”¨æˆ·ã€çŸ­æœŸæ¶ˆæ¯
    db.goï¼šMongoDB / MySQL å­˜å‚¨å†å²æ¶ˆæ¯ï¼Œæ”¯æŒæ¶ˆæ¯å›æ”¾

HTTP API (api/rest/)

user.goï¼šæŸ¥è¯¢åœ¨çº¿ç”¨æˆ·

message.goï¼šå‘é€ WebSocket æ¶ˆæ¯ï¼ˆREST APIï¼‰


ğŸš€ ä¸‹ä¸€æ­¥
å®ç° WebSocket æœåŠ¡å™¨ (internal/server/)

WebSocket äº‹ä»¶å¤„ç† (internal/server/handler.go)

ä½¿ç”¨ Redis è¿›è¡Œåˆ†å¸ƒå¼æ”¯æŒ (internal/broker/redis_broker.go)





IM ç³»ç»Ÿçš„æ–‡ä»¶å¤¹ç»“æ„è®¾è®¡
ä¸€ä¸ªå…¸å‹çš„ IM ç³»ç»Ÿ çš„æ–‡ä»¶å¤¹ç»“æ„é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š

/im-system
â”‚
â”œâ”€â”€ /cmd                     # å¯åŠ¨ç¨‹åºçš„å…¥å£
â”‚   â””â”€â”€ main.go              # ä¸»ç¨‹åºå…¥å£
â”‚
â”œâ”€â”€ /config                  # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ config.yaml          # é…ç½®æ–‡ä»¶ï¼Œå­˜å‚¨æ•°æ®åº“ã€Redisã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰é…ç½®ä¿¡æ¯
â”‚
â”œâ”€â”€ /internal                # å†…éƒ¨å®ç°é€»è¾‘
â”‚   â”œâ”€â”€ /auth                # èº«ä»½éªŒè¯ã€æ³¨å†Œã€ç™»å½•ç›¸å…³é€»è¾‘
â”‚   â”œâ”€â”€ /message             # æ¶ˆæ¯ç›¸å…³çš„å¤„ç†é€»è¾‘
â”‚   â”œâ”€â”€ /user                # ç”¨æˆ·ä¿¡æ¯çš„ç®¡ç†å’Œå­˜å–
â”‚   â”œâ”€â”€ /group               # ç¾¤ç»„åŠŸèƒ½ç›¸å…³çš„é€»è¾‘
â”‚   â”œâ”€â”€ /file                # æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½å¤„ç†
â”‚   â”œâ”€â”€ /push                # æ¨é€é€šçŸ¥æœåŠ¡
â”‚   â””â”€â”€ /websocket           # WebSocket è¿æ¥ç®¡ç†
â”‚
â”œâ”€â”€ /pkg                     # å…¬å…±åº“æ–‡ä»¶ï¼Œä¾›ä¸åŒæ¨¡å—ä½¿ç”¨
â”‚   â”œâ”€â”€ /utils               # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ /db                  # æ•°æ®åº“ç›¸å…³æ“ä½œ
â”‚   â”œâ”€â”€ /redis               # Redis è¿æ¥åŠæ“ä½œ
â”‚   â””â”€â”€ /logger              # æ—¥å¿—è®°å½•
â”‚
â”œâ”€â”€ /api                     # å¯¹å¤–æä¾›çš„ API æ¥å£
â”‚   â”œâ”€â”€ /v1                  # ç¬¬ä¸€ç‰ˆ API
â”‚   â”œâ”€â”€ /v2                  # ç¬¬äºŒç‰ˆ API
â”‚   â””â”€â”€ /common              # å…¬å…± API å’Œä¸­é—´ä»¶
â”‚
â”œâ”€â”€ /scripts                 # éƒ¨ç½²è„šæœ¬ã€æ•°æ®åº“è¿ç§»è„šæœ¬ç­‰
â”‚
â””â”€â”€ /test                    # æµ‹è¯•ä»£ç 
    â”œâ”€â”€ /unit                # å•å…ƒæµ‹è¯•
    â””â”€â”€ /integration         # é›†æˆæµ‹è¯•


