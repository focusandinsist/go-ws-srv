# go-ws-srv
 
q:æœ‰socketIOä¸ºå•¥è¿˜åšè¿™ä¸ªï¼Ÿ
a:é‚£åƒåœ¾socketIoé¢‘ç¹æ›´æ–°è¿˜ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œè°ç”¨è°sb

è¿™é‡Œæ˜¯ WebSocket æ¨é€ç³»ç»Ÿ çš„ æ–‡ä»¶æ¶æ„è®¾è®¡ï¼ŒæŒ‰ç…§ æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†ï¼Œä¿è¯ é«˜å¹¶å‘ã€å¯æ‰©å±•ã€åˆ†å¸ƒå¼æ”¯æŒï¼Œç›®æ ‡æ˜¯ Socket.IO æ›¿ä»£å“ã€‚

ğŸ“‚ æ–‡ä»¶ç»“æ„
websocket-server/
â”‚â”€â”€ cmd/                  # å…¥å£ç›®å½•
â”‚   â”œâ”€â”€ main.go           # å¯åŠ¨ WebSocket æœåŠ¡å™¨
â”‚
â”‚â”€â”€ config/               # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.yaml       # é…ç½®æ–‡ä»¶ (ç«¯å£ã€Redis åœ°å€ç­‰)
â”‚   â”œâ”€â”€ config.go         # è§£æé…ç½®æ–‡ä»¶
â”‚
â”‚â”€â”€ internal/             # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ server/           # WebSocket æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ server.go     # WebSocket æœåŠ¡å™¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ connection.go # è¿æ¥ç®¡ç†ï¼ˆå­˜å‚¨åœ¨çº¿ç”¨æˆ·ã€å¿ƒè·³æ£€æµ‹ï¼‰
â”‚   â”‚   â”œâ”€â”€ handler.go    # å¤„ç† WebSocket äº‹ä»¶
â”‚   â”‚   â”œâ”€â”€ message.go    # æ¶ˆæ¯ç®¡ç†ï¼ˆå¹¿æ’­ã€ç§èŠã€é¢‘é“ï¼‰
â”‚   â”‚   â”œâ”€â”€ room.go       # é¢‘é“/æˆ¿é—´ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ auth.go       # è®¤è¯ï¼ˆJWT / Token éªŒè¯ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ storage/          # å­˜å‚¨å±‚
â”‚   â”‚   â”œâ”€â”€ redis.go      # Redis å­˜å‚¨ç”¨æˆ·çŠ¶æ€ / æ¶ˆæ¯é˜Ÿåˆ—
â”‚   â”‚   â”œâ”€â”€ db.go         # MongoDB / MySQL å­˜å‚¨å†å²æ¶ˆæ¯
â”‚   â”‚
â”‚   â”œâ”€â”€ broker/           # æ¶ˆæ¯åˆ†å‘å±‚
â”‚   â”‚   â”œâ”€â”€ redis_broker.go # ä½¿ç”¨ Redis Pub/Sub è¿›è¡Œæ¶ˆæ¯åŒæ­¥
â”‚   â”‚   â”œâ”€â”€ kafka_broker.go # ä½¿ç”¨ Kafka è¿›è¡Œæ¶ˆæ¯åŒæ­¥
â”‚
â”‚â”€â”€ api/                  # æä¾› HTTP API
â”‚   â”œâ”€â”€ rest/             # REST API
â”‚   â”‚   â”œâ”€â”€ user.go       # è·å–åœ¨çº¿ç”¨æˆ·
â”‚   â”‚   â”œâ”€â”€ message.go    # å‘é€æ¶ˆæ¯æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ websocket/        # WebSocket API
â”‚   â”‚   â”œâ”€â”€ ws_handler.go # WebSocket å¤„ç†å…¥å£
â”‚
â”‚â”€â”€ pkg/                  # é€šç”¨å·¥å…·åŒ…
â”‚   â”œâ”€â”€ logger/           # æ—¥å¿—ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ logger.go     # æ—¥å¿—å°è£…
â”‚   â”œâ”€â”€ utils/            # å¸¸ç”¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ json.go       # JSON å¤„ç†
â”‚   â”‚   â”œâ”€â”€ uuid.go       # ç”Ÿæˆå”¯ä¸€ ID
â”‚
â”‚â”€â”€ test/                 # æµ‹è¯•
â”‚   â”œâ”€â”€ load_test.go      # å‹æµ‹è„šæœ¬ï¼ˆæ¨¡æ‹Ÿ 10w+ è¿æ¥ï¼‰
â”‚
â”‚â”€â”€ go.mod                # Go ä¾èµ–ç®¡ç†
â”‚â”€â”€ Dockerfile            # Docker éƒ¨ç½²
â”‚â”€â”€ README.md             # é¡¹ç›®æ–‡æ¡£


ğŸ“Œ ä¸»è¦è®¾è®¡æ€è·¯
WebSocket æœåŠ¡å™¨ (internal/server/)

server.goï¼šç›‘å¬ WebSocket è¿æ¥ï¼Œç®¡ç† goroutine

connection.goï¼šå­˜å‚¨åœ¨çº¿ç”¨æˆ·ã€å¿ƒè·³æ£€æµ‹ã€æ–­çº¿æ¢å¤

message.goï¼šå¤„ç†å¹¿æ’­ã€ç§èŠã€æˆ¿é—´å†…èŠå¤©

auth.goï¼šæ”¯æŒ JWT è®¤è¯ï¼Œä¿è¯è¿æ¥å®‰å…¨

room.goï¼šæ”¯æŒé¢‘é“ç®¡ç†ï¼Œç”¨æˆ·å¯ä»¥è®¢é˜…é¢‘é“

æ¶ˆæ¯åˆ†å‘ (internal/broker/)

redis_broker.goï¼šç”¨ Redis Pub/Sub è¿›è¡Œè·¨æœåŠ¡å™¨æ¶ˆæ¯åŒæ­¥

kafka_broker.goï¼šç”¨ Kafka è¿›è¡Œå¤§è§„æ¨¡æ¶ˆæ¯åˆ†å‘

å­˜å‚¨ (internal/storage/)

redis.goï¼šç”¨ Redis å­˜å‚¨åœ¨çº¿ç”¨æˆ·ã€çŸ­æœŸæ¶ˆæ¯

db.goï¼šMongoDB / MySQL å­˜å‚¨å†å²æ¶ˆæ¯ï¼Œæ”¯æŒæ¶ˆæ¯å›æ”¾

HTTP API (api/rest/)

user.goï¼šæŸ¥è¯¢åœ¨çº¿ç”¨æˆ·

message.goï¼šå‘é€ WebSocket æ¶ˆæ¯ï¼ˆREST APIï¼‰


ğŸš€ ä¸‹ä¸€æ­¥
å®ç° WebSocket æœåŠ¡å™¨ (internal/server/)

WebSocket äº‹ä»¶å¤„ç† (internal/server/handler.go)

ä½¿ç”¨ Redis è¿›è¡Œåˆ†å¸ƒå¼æ”¯æŒ (internal/broker/redis_broker.go)
